<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:rich="http://richfaces.org/rich">
<h:head>
	<meta charset="utf-8" />
	<title>Accueil Investisseur</title>
	<h:outputStylesheet library="default" name="css/form.css" />
</h:head>
<h:body>
	<f:metadata>
		<c:set value="#{connexionBean.utilisateur}" target="#{achatVenteBean}"
			property="utilisateur" />
		<f:viewAction action="#{achatVenteBean.rechercheIdInvest()}" />
		<f:viewAction action="#{achatVenteBean.rechercheContratL()}" />
		<f:viewAction action="#{achatVenteBean.recherchePossessions()}" />
		<f:viewAction action="#{achatVenteBean.rechercheInfos()}" />
	</f:metadata>

	<!-- PARTIE INFOS -->
	<h:form id="formInfos">
		<fieldset>
			<legend>INFOS</legend>
			<f:ajax event="click" />

			<h:selectOneMenu value="#{achatVenteBean.secteurI}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{secteurBean.societes}" var="secteur"
					itemValue="#{secteur.VSecteur}" itemLabel="#{secteur.VSecteur}" />
				<f:ajax listener="#{achatVenteBean.rechercheInfos()}"
					render="infos" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:selectOneMenu value="#{achatVenteBean.firmI}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{societeBean.societes}" var="societe"
					itemValue="#{societe.nom}" itemLabel="#{societe.nom}" />
				<f:ajax listener="#{achatVenteBean.rechercheInfos()}"
					render="infos" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:panelGroup id="infos">
				<br />
				<h:dataTable value="#{achatVenteBean.resultatI}" var="row">
					<h:column>
						<f:facet name="header">
							<h:outputText value="Societe" />
						</f:facet>
						<h:outputText value="#{row[2]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Secteur" />
						</f:facet>
						<h:outputText value="#{row[0]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Date" />
						</f:facet>
						<h:outputText value="#{row[1]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Info" />
						</f:facet>
						<h:outputText value="#{row[3]}" />
					</h:column>

				</h:dataTable>
			</h:panelGroup>
		</fieldset>
	</h:form>

	<!-- PARTIE POSSESSION -->
	<h:form id="formPossessions">
		<fieldset>
			<legend>POSSESSIONS</legend>

			<h:selectOneMenu value="#{achatVenteBean.secteurP}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{secteurBean.societes}" var="secteur"
					itemValue="#{secteur.VSecteur}" itemLabel="#{secteur.VSecteur}" />
				<f:ajax listener="#{achatVenteBean.recherchePossessions()}"
					render="pos" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:selectOneMenu value="#{achatVenteBean.firmP}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{societeBean.societes}" var="societe"
					itemValue="#{societe.nom}" itemLabel="#{societe.nom}" />
				<f:ajax listener="#{achatVenteBean.recherchePossessions()}"
					render="pos" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:panelGroup id="pos">
				<h:dataTable value="#{achatVenteBean.resultatP}" var="row">

					<h:column>
						<f:facet name="header">
							<h:outputText value="Societe" />
						</f:facet>
						<h:outputText value="#{row[3]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Secteur" />
						</f:facet>
						<h:outputText value="#{row[0]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Date d'achat" />
						</f:facet>
						<h:outputText value="#{row[2]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Prix d'achat" />
						</f:facet>
						<h:outputText value="#{row[1]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Mise en vente" />
						</f:facet>
						<h:commandButton value="Vendre" styleClass="sansLabel"
							converter="javax.faces.Float">
							<f:setPropertyActionListener target="#{achatVenteBean.idContrat}"
								value="#{row[4]}" />
							<f:setPropertyActionListener target="#{achatVenteBean.dateAchat}"
								value="#{row[2]}" />
							<f:setPropertyActionListener target="#{achatVenteBean.prixAchat}"
								value="#{row[1]}" />
						</h:commandButton>
					</h:column>

				</h:dataTable>
				<h:panelGroup rendered="#{achatVenteBean.idContrat!=0}">

					<h:outputLabel for="valider"> Prix de vente : <span
							class="requis">*</span>
					</h:outputLabel>
					<h:inputText id="valider" value="#{achatVenteBean.prix}"
						converter="javax.faces.Float">
						<f:ajax event="blur" render="validerMessage" />
						<f:validator binding="#{venteValidator}" />
					</h:inputText>
					<h:message id="validerMessage" for="valider" errorClass="erreur" />
					<br />

					<h:outputLabel> Mettre aux enchères
					</h:outputLabel>
					<h:selectBooleanCheckbox value="#{achatVenteBean.estEnchere}">
						<f:ajax render="panelE" />
					</h:selectBooleanCheckbox>
					<br />

					<h:panelGroup id="panelE">
						<h:panelGroup rendered="#{achatVenteBean.estEnchere=='true'}">
							<h:outputLabel for="date"> Date finale enchère (yyyy-mm-dd) : <span
									class="requis">*</span>
							</h:outputLabel>
							<h:inputText id="date" value="#{achatVenteBean.dateEnchere}"
								binding="#{composantDate}">
								<f:ajax event="blur" execute="date heure"
									render="validerDate validerheure" />
							</h:inputText>
							<h:message id="validerDate" for="date" errorClass="erreur" />
							<br />

							<h:outputLabel for="heure"> Heure finale enchère (hh:mm:ss) : <span
									class="requis">*</span>
							</h:outputLabel>
							<h:inputText id="heure" value="#{achatVenteBean.heureEnchere}">
								<f:validator validatorId="dateValidator" />
								<f:attribute name="composantDate" value="#{composantDate}" />
								<f:ajax event="blur" render="validerheure" />
							</h:inputText>
							<h:message id="validerheure" for="heure" errorClass="erreur" />
							<br />
						</h:panelGroup>
					</h:panelGroup>

					<h:commandButton value="Valider"
						action="#{achatVenteBean.vendre()}" styleClass="sansLabel" />
					<h:commandButton value="Annuler" styleClass="sansLabel"
						converter="javax.faces.Integer" immediate="true">
						<f:setPropertyActionListener target="#{achatVenteBean.idContrat}"
							value="0" />
					</h:commandButton>

				</h:panelGroup>
			</h:panelGroup>

			<h:messages globalOnly="true" infoClass="info" />
		</fieldset>
	</h:form>

	<!-- PARTIE LOGS -->
	<h:form id="formLog">
		<fieldset>
			<legend>LOGS</legend>
			<f:ajax event="click" />

			<h:selectOneMenu value="#{achatVenteBean.secteurL}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{secteurBean.societes}" var="secteur"
					itemValue="#{secteur.VSecteur}" itemLabel="#{secteur.VSecteur}" />
				<f:ajax listener="#{achatVenteBean.rechercheContratL()}"
					render="logs" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:selectOneMenu value="#{achatVenteBean.firmL}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{societeBean.societes}" var="societe"
					itemValue="#{societe.nom}" itemLabel="#{societe.nom}" />
				<f:ajax listener="#{achatVenteBean.rechercheContratL()}"
					render="logs" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:panelGroup id="logs">
				<br />
				<h:dataTable value="#{achatVenteBean.resultatL}" var="row">
					<h:column>
						<f:facet name="header">
							<h:outputText value="Societe" />
						</f:facet>
						<h:outputText value="#{row[4]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Secteur" />
						</f:facet>
						<h:outputText value="#{row[0]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Date" />
						</f:facet>
						<h:outputText value="#{row[1]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Prix" />
						</f:facet>
						<h:outputText value="#{row[2]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Achat(1) Vente(0)" />
						</f:facet>
						<h:outputText value="#{row[3]}" />
					</h:column>

				</h:dataTable>
			</h:panelGroup>
		</fieldset>
	</h:form>
</h:body>
</html>