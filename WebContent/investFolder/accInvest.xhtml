<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core">
<h:head>
	<meta charset="utf-8" />
	<title>Accueil Investisseur</title>
	<h:outputStylesheet library="default" name="css/form.css" />
</h:head>
<h:body>
	<f:metadata>
		<c:set value="#{connexionBean.utilisateur}" target="#{achatVenteBean}"
			property="utilisateur" />
		<f:viewAction action="#{achatVenteBean.rechercheIdInvest()}" />
		<f:viewAction action="#{achatVenteBean.rechercheContratL()}" />
		<f:viewAction action="#{achatVenteBean.recherchePossessions()}" />
	</f:metadata>

	<!-- PARTIE POSSESSION -->
	<h:form id="formPossessions">
		<fieldset>
			<legend>POSSESSIONS</legend>

			<h:selectOneMenu value="#{achatVenteBean.secteurP}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{secteurBean.societes}" var="secteur"
					itemValue="#{secteur.VSecteur}" itemLabel="#{secteur.VSecteur}" />
				<f:ajax listener="#{achatVenteBean.recherchePossessions()}"
					render="pos" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:selectOneMenu value="#{achatVenteBean.firmP}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{societeBean.societes}" var="societe"
					itemValue="#{societe.nom}" itemLabel="#{societe.nom}" />
				<f:ajax listener="#{achatVenteBean.recherchePossessions()}"
					render="pos" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:panelGroup id="pos">
				<h:dataTable value="#{achatVenteBean.resultatP}" var="row">

					<h:column>
						<f:facet name="header">
							<h:outputText value="Societe" />
						</f:facet>
						<h:outputText value="#{row[3]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Secteur" />
						</f:facet>
						<h:outputText value="#{row[0]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Date d'achat" />
						</f:facet>
						<h:outputText value="#{row[2]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Prix d'achat" />
						</f:facet>
						<h:outputText value="#{row[1]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Mise en vente" />
						</f:facet>
						<h:commandButton value="Vendre"
							action="#{achatVenteBean.vendre()}" styleClass="sansLabel"
							converter="javax.faces.Integer">
							<f:setPropertyActionListener
								target="#{achatVenteBean.misEnVentes}" value="#{row[4]}" />
						</h:commandButton>
					</h:column>

				</h:dataTable>
				<h:panelGroup rendered="#{achatVenteBean.misEnVentes!=0}">

					<h:outputLabel for="valider"> Prix de vente : <span
							class="requis">*</span>
					</h:outputLabel>
					<h:inputText id="valider" value="#{achatVenteBean.prix}"
						converter="javax.faces.Float">
						<f:ajax event="blur" render="validerMessage" />
						<f:validator binding="#{venteValidator}" />
					</h:inputText>
					<h:message id="validerMessage" for="valider" errorClass="erreur" />
					<br />
					<h:commandButton value="Valider"
						action="#{achatVenteBean.vendre()}" styleClass="sansLabel" />
					<h:commandButton value="Annuler" styleClass="sansLabel"
						converter="javax.faces.Integer" immediate="true">
						<f:setPropertyActionListener
							target="#{achatVenteBean.misEnVentes}" value="0" />
					</h:commandButton>
					<span> #{achatVenteBean.misEnVentes} #{achatVenteBean.prix}
					</span>

				</h:panelGroup>
			</h:panelGroup>

			<h:messages globalOnly="true" infoClass="info" />
		</fieldset>
	</h:form>

	<!-- PARTIE LOG -->
	<h:form id="formLog">
		<fieldset>
			<legend>LOGS</legend>
			<f:ajax event="click" />

			<h:selectOneMenu value="#{achatVenteBean.secteurL}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{secteurBean.societes}" var="secteur"
					itemValue="#{secteur.VSecteur}" itemLabel="#{secteur.VSecteur}" />
				<f:ajax listener="#{achatVenteBean.rechercheContratL()}"
					render="logs" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:selectOneMenu value="#{achatVenteBean.firmL}">
				<f:selectItem itemValue=" " itemLabel=" " />
				<f:selectItems value="#{societeBean.societes}" var="societe"
					itemValue="#{societe.nom}" itemLabel="#{societe.nom}" />
				<f:ajax listener="#{achatVenteBean.rechercheContratL()}"
					render="logs" />
				<f:ajax event="click" />
			</h:selectOneMenu>

			<h:panelGroup id="logs">
				<br />
				<h:dataTable value="#{achatVenteBean.resultatL}" var="row">
					<h:column>
						<f:facet name="header">
							<h:outputText value="Societe" />
						</f:facet>
						<h:outputText value="#{row[4]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Secteur" />
						</f:facet>
						<h:outputText value="#{row[0]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Date" />
						</f:facet>
						<h:outputText value="#{row[1]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Prix" />
						</f:facet>
						<h:outputText value="#{row[2]}" />
					</h:column>

					<h:column>
						<f:facet name="header">
							<h:outputText value="Achat(1) Vente(0)" />
						</f:facet>
						<h:outputText value="#{row[3]}" />
					</h:column>

				</h:dataTable>
			</h:panelGroup>
		</fieldset>
	</h:form>
</h:body>
</html>